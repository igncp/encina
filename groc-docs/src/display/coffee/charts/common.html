<!DOCTYPE html><html lang="en"><head><title>src/display/coffee/charts/common</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="src/display/coffee/charts/common"><meta name="groc-project-path" content="src/display/coffee/charts/common.coffee"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/display/coffee/charts/common.coffee</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper">define <span class="hljs-string">'charts/common'</span>,<span class="hljs-function"> -&gt;</span>
  common = {}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns a colors scale generated with a colors array and data</p></div></div><div class="code"><div class="wrapper">  common.<span class="hljs-function"><span class="hljs-title">createColorsScale</span> = <span class="hljs-params">(colors, data, key = <span class="hljs-literal">null</span>)</span>-&gt;</span>
    c = d3
      .scale.linear()
      .domain<span class="hljs-function"><span class="hljs-params">(d3.extent(data, (d)-&gt; <span class="hljs-keyword">if</span> key <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> d[key] <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> d))</span>
      .<span class="hljs-title">range</span><span class="hljs-params">([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])</span>

    <span class="hljs-title">colorScale</span> = <span class="hljs-title">d3</span>
      .<span class="hljs-title">scale</span>.<span class="hljs-title">linear</span><span class="hljs-params">()</span>
      .<span class="hljs-title">domain</span><span class="hljs-params">(d3.range(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1.0</span> / (colors.length)))</span>
      .<span class="hljs-title">range</span> <span class="hljs-title">colors</span>
    
    <span class="hljs-title">colorScaleFn</span> = <span class="hljs-params">(d)</span>-&gt;</span> colorScale(c(d))
    colorScaleFn

  common.<span class="hljs-function"><span class="hljs-title">waitTillElPresent</span> = <span class="hljs-params">(elId, cb)</span>-&gt;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is not done with async&#39;s <code>until</code> because it stopped the loop</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-title">wait</span> = <span class="hljs-params">(wcb)</span>-&gt;</span>
      <span class="hljs-keyword">if</span> <span class="hljs-built_in">document</span>.getElementById(elId) <span class="hljs-keyword">then</span> wcb()
      <span class="hljs-keyword">else</span> setTimeout (<span class="hljs-function">-&gt;</span> wait(wcb)), <span class="hljs-number">100</span>
    
    wait(cb)

  common.<span class="hljs-function"><span class="hljs-title">createSvgFilterColor</span> = <span class="hljs-params">(id, svg, deviation, slope, extra = <span class="hljs-literal">false</span>)</span>-&gt;</span>
    defs = svg.append <span class="hljs-string">'defs'</span>
    filter = defs.append(<span class="hljs-string">'filter'</span>)
      .attr {<span class="hljs-attribute">id</span>: id}
    filter.attr({<span class="hljs-attribute">width</span>: <span class="hljs-string">'500%'</span>, <span class="hljs-attribute">height</span>: <span class="hljs-string">'500%'</span>, <span class="hljs-attribute">x</span>: <span class="hljs-string">'-200%'</span>, <span class="hljs-attribute">y</span>: <span class="hljs-string">'-200%'</span>}) <span class="hljs-keyword">if</span> extra
    filter.append <span class="hljs-string">'feOffset'</span>
      .attr {<span class="hljs-attribute">result</span>: <span class="hljs-string">'offOut'</span>, <span class="hljs-attribute">in</span>: <span class="hljs-string">'SourceGraphic'</span>, <span class="hljs-attribute">dx</span>: <span class="hljs-number">.5</span>, <span class="hljs-attribute">dy</span>: <span class="hljs-number">.5</span>}
    filter.append(<span class="hljs-string">'feGaussianBlur'</span>)
      .attr {<span class="hljs-attribute">result</span>: <span class="hljs-string">'blurOut'</span>, <span class="hljs-attribute">in</span>: <span class="hljs-string">'offOut'</span>, <span class="hljs-attribute">stdDeviation</span>: deviation}
    filter.append(<span class="hljs-string">'feBlend'</span>)
      .attr {<span class="hljs-attribute">in</span>: <span class="hljs-string">'SourceGraphic'</span>, <span class="hljs-attribute">in2</span>: <span class="hljs-string">'blurOut'</span>, <span class="hljs-attribute">mode</span>: <span class="hljs-string">'normal'</span>}
    filter.append <span class="hljs-string">'feComponentTransfer'</span>
      .append <span class="hljs-string">'feFuncA'</span>
      .attr {<span class="hljs-attribute">type</span>: <span class="hljs-string">'linear'</span>, <span class="hljs-attribute">slope</span>: slope}

  common.<span class="hljs-function"><span class="hljs-title">createSvgFilterBlack</span> = <span class="hljs-params">(id, svg, deviation, slope)</span>-&gt;</span>
    defs = svg.append <span class="hljs-string">'defs'</span>
    filter = defs.append(<span class="hljs-string">'filter'</span>)
      .attr({<span class="hljs-attribute">id</span>: id, <span class="hljs-attribute">width</span>: <span class="hljs-string">'500%'</span>, <span class="hljs-attribute">height</span>: <span class="hljs-string">'500%'</span>, \
        <span class="hljs-attribute">x</span>: <span class="hljs-string">'-200%'</span>, <span class="hljs-attribute">y</span>: <span class="hljs-string">'-200%'</span>})
    filter.append <span class="hljs-string">'feGaussianBlur'</span>
      .attr {<span class="hljs-attribute">in</span>: <span class="hljs-string">'SourceAlpha'</span>, <span class="hljs-attribute">stdDeviation</span>: deviation}
    filter.append <span class="hljs-string">'feOffset'</span>
      .attr {<span class="hljs-attribute">dx</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">dy</span>: <span class="hljs-number">1</span>}
    filter.append <span class="hljs-string">'feComponentTransfer'</span>
      .append <span class="hljs-string">'feFuncA'</span>
      .attr {<span class="hljs-attribute">type</span>: <span class="hljs-string">'linear'</span>, <span class="hljs-attribute">slope</span>: slope}
    feMerge = filter.append <span class="hljs-string">'feMerge'</span>
    feMerge.append <span class="hljs-string">'feMergeNode'</span>
    feMerge.append <span class="hljs-string">'feMergeNode'</span>
      .attr <span class="hljs-string">'in'</span>, <span class="hljs-string">'SourceGraphic'</span>


  common.<span class="hljs-function"><span class="hljs-title">nbrWCommas</span> = <span class="hljs-params">(x, decimals = <span class="hljs-number">0</span>)</span>-&gt;</span>
    x = x.toFixed(decimals)
    parts = x.toString().split <span class="hljs-string">'.'</span>
    final = parts[<span class="hljs-number">0</span>] = parts[<span class="hljs-number">0</span>].replace <span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">','</span>
    final = parts.join <span class="hljs-string">'.'</span>

  common</div></div></div></div></body></html>